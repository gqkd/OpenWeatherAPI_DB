#How many distinct weather conditions were observed (rain/snow/clear/…) in a certain period?
SELECT COUNT(DISTINCT ID_WEATHER_TYPE)
FROM FACT_WEATHER
WHERE OBSERVATION_TS BETWEEN '2024-09-30' AND '2024-010-30';


#Rank the most common weather conditions in a certain period of time per city
#MIGLIORAREEEEE PERCHè DICE PER CITTA, MENTRE COSì SONO MISCHIATI

SELECT 
    A.ID_CITY,
    C.CITY_NAME,
    A.ID_WEATHER_TYPE,
    B.WEATHER_TYPE_LDS,
    COUNT(*) AS FREQUENZA
FROM FACT_WEATHER A 
LEFT JOIN LK_WEATHER_TYPE B ON A.ID_WEATHER_TYPE = B.ID_WEATHER_TYPE
LEFT JOIN LK_CITIES C ON A.ID_CITY = C.ID_CITY
WHERE OBSERVATION_TS BETWEEN '2024-09-30' AND '2024-10-30'
GROUP BY ID_CITY, ID_WEATHER_TYPE
ORDER BY ID_CITY, RANK() OVER (PARTITION BY A.ID_CITY ORDER BY COUNT(*) DESC);

#What are the temperature averages observed in a certain period per city?
SELECT 
    A.ID_CITY,
    B.CITY_NAME,
    AVG(TEMPERATURE) AS AVG_TEMP
FROM FACT_WEATHER A 
LEFT JOIN LK_CITIES B ON A.ID_CITY = B.ID_CITY
WHERE OBSERVATION_TS BETWEEN '2024-09-30' AND '2024-10-30'
GROUP BY ID_CITY;

#What city had the highest absolute temperature in a certain period of time?
SELECT 
    A.ID_CITY,
    B.CITY_NAME,
    MAX(TEMPERATURE) AS MAX_TEMP
FROM FACT_WEATHER A
LEFT JOIN LK_CITIES B ON A.ID_CITY = B.ID_CITY
WHERE OBSERVATION_TS BETWEEN '2024-09-30' AND '2024-10-30'
GROUP BY A.ID_CITY
ORDER BY MAX_TEMP DESC;

#Which city had the highest daily temperature variation in a certain period of time?
SELECT 
    A.ID_CITY,
    B.CITY_NAME,
    DATE(OBSERVATION_TS) AS OSSERVAZIONE,
    MAX(TEMPERATURE) - MIN(TEMPERATURE) AS VARIAZIONE
FROM FACT_WEATHER A
LEFT JOIN LK_CITIES B ON A.ID_CITY = B.ID_CITY
WHERE OBSERVATION_TS BETWEEN '2024-09-30' AND '2024-10-30'
GROUP BY ID_CITY, OSSERVAZIONE
ORDER BY VARIAZIONE DESC;


#What city had the strongest wind in a certain period of time?
SELECT 
    A.ID_CITY,
    B.CITY_NAME,
    MAX(WIND_SPEED) AS MAX_SPEED
FROM FACT_WEATHER A
LEFT JOIN LK_CITIES B ON A.ID_CITY = B.ID_CITY
WHERE OBSERVATION_TS BETWEEN '2024-09-30' AND '2024-10-30'
GROUP BY ID_CITY
ORDER BY MAX_SPEED DESC;